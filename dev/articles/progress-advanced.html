<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced cli progress bars • cli</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced cli progress bars">
<meta name="description" content="Progress bar overhead, customization and the C progress bar API.
">
<meta property="og:description" content="Progress bar overhead, customization and the C progress bar API.
">
<meta name="robots" content="noindex">
<script defer data-domain="cli.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cli</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.6.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/faq.html">FAQ</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/semantic-cli.html">Building a Semantic CLI</a></li>
    <li><a class="dropdown-item" href="../articles/usethis-ui.html">From usethis::ui functions to cli</a></li>
    <li><a class="dropdown-item" href="../articles/pluralization.html">cli pluralization</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Progress bars</h6></li>
    <li><a class="dropdown-item" href="../articles/progress.html">Introduction to progress bars in cli</a></li>
    <li><a class="dropdown-item" href="../articles/progress-advanced.html">Advanced cli progress bars</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/palettes.html">cli color palettes</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/cli/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced cli progress bars</h1>
                        <h4 data-toc-skip class="author">Gábor
Csárdi</h4>
            
            <h4 data-toc-skip class="date">2024-10-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/cli/blob/main/vignettes/progress-advanced.Rmd" class="external-link"><code>vignettes/progress-advanced.Rmd</code></a></small>
      <div class="d-none name"><code>progress-advanced.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cli.r-lib.org">cli</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overhead">Overhead<a class="anchor" aria-label="anchor" href="#overhead"></a>
</h2>
<p>cli progress bars do have an overhead that may or may not be
significant for your use case. In the R API, if you have a tight loop,
then you should not update the progress bar too often.</p>
<div class="section level3">
<h3 id="minimizing-overhead">Minimizing overhead<a class="anchor" aria-label="anchor" href="#minimizing-overhead"></a>
</h3>
<p>To minimize progress bar overhead, <code><a href="../reference/cli_progress_bar.html">cli_progress_update()</a></code>
uses an internal timer and only update the progress bar on the screen if
the timer is due.</p>
<p>In C code, you can refer to the timer directly to avoid an update.
The <code>CLI_SHOULD_TICK</code> macro evaluates to one if the timer is
due and an update is needed, otherwise to zero.
<code>CLI_SHOULD_TICK</code> only works if you already created a cli
progress bar from C, or you called
<code>cli_progress_init_timer()</code>. The latter initializes the cli
timer without creating a progress bar. (If the timer is not initialized,
then <code>CLI_SHOULD_TICK</code> evaluates to zero.)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>  SEXP bar <span class="op">=</span> PROTECT<span class="op">(</span>cli_progress_bar<span class="op">(</span>num_iters<span class="op">,</span> NULL<span class="op">));</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> num_iters<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>CLI_SHOULD_TICK<span class="op">)</span> cli_progress_set<span class="op">(</span>bar<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  cli_progress_done<span class="op">(</span>bar<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="non-interactive-r-sessions">Non-interactive R sessions<a class="anchor" aria-label="anchor" href="#non-interactive-r-sessions"></a>
</h2>
<p>cli output is different if the terminal or platform is not
<em>dynamic</em>, i.e. if it does not support the <code>\r</code>
character to move the cursor to the beginning of the line without
starting a new line. This often happens when R is running
non-interactively and the standard error is redirected to a file. cli
uses the <code><a href="../reference/is_dynamic_tty.html">cli::is_dynamic_tty()</a></code> function to determine if the
output supports <code>\r</code>.</p>
<p>On a non-dynamic terminal, cli simply prints progress updates as new
lines to the screen. Frequently updating the progress in this fashion
would produce a lot of output, so on non-dynamic terminals cli falls
back to a slower timer update interval.</p>
<p>By default the cli timer signals every 3000 milliseconds in an R
session without a dynamic terminal, instead of 200 milliseconds.</p>
<!-- TODO: example -->
</div>
<div class="section level2">
<h2 id="progress-bars-in-scripts">Progress bars in scripts<a class="anchor" aria-label="anchor" href="#progress-bars-in-scripts"></a>
</h2>
<p>You can use progress bars in R scripts, just like you use them in R
packages.</p>
<p>In an R script you might create a progress bar from the global
environment, instead from within a function call. The global environment
also has a <em>current</em> progress bar, so when you create a progress
bar from the global environment, the previous one from the same
environment is terminated. However, there is not function to return
from, so the last progress bar of the script will be only terminated
when the script terminates, or when you explicitly terminate it using
<code><a href="../reference/cli_progress_bar.html">cli_progress_done()</a></code>.</p>
<!-- # Nested progress bars TODO -->
</div>
<div class="section level2">
<h2 id="customization">Customization<a class="anchor" aria-label="anchor" href="#customization"></a>
</h2>
<p>cli progress bars can be customized by the developer and the end
user, by setting options, providing function arguments and regular cli
themes.</p>
<p>Some aspects can only be customized by the developer, and some others
can only be customized by the end user. Others can be customized by
both, with the end user’s setting taking precedence.</p>
<div class="section level3">
<h3 id="developer-customization">Developer customization<a class="anchor" aria-label="anchor" href="#developer-customization"></a>
</h3>
<div class="section level4">
<h4 id="about-progress-bar-types">About progress bar types<a class="anchor" aria-label="anchor" href="#about-progress-bar-types"></a>
</h4>
<p>Each progress bar type has a default display (format string), which
can be configured by the end user. The current progress bar types are,
with their default display, with known and unknown number of total
progress units.</p>
</div>
<div class="section level4">
<h4 id="iterator">
<code>iterator</code><a class="anchor" aria-label="anchor" href="#iterator"></a>
</h4>
<p>Typically for loops and mapping functions. It shows a bar by default,
if the total number of iterations is known.</p>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-2.svg" width="100%"></p>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-3.svg" width="100%"></p>
</div>
<div class="section level4">
<h4 id="tasks">
<code>tasks</code><a class="anchor" aria-label="anchor" href="#tasks"></a>
</h4>
<p>For a list of tasks, by default it shows a <code>current/total</code>
display.</p>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-4.svg" width="100%"></p>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-5.svg" width="100%"></p>
</div>
<div class="section level4">
<h4 id="download">
<code>download</code><a class="anchor" aria-label="anchor" href="#download"></a>
</h4>
<p>For downloads, progress units are shown as bytes by default here.</p>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-6.svg" width="100%"></p>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-7.svg" width="100%"></p>
</div>
<div class="section level4">
<h4 id="custom">
<code>custom</code><a class="anchor" aria-label="anchor" href="#custom"></a>
</h4>
<p>For custom displays, the developer has to specify an format string
for <code>custom</code> progress bars.</p>
</div>
<div class="section level4">
<h4 id="custom-format-strings-by-the-developer">Custom format strings (by the developer)<a class="anchor" aria-label="anchor" href="#custom-format-strings-by-the-developer"></a>
</h4>
<p>The developer can specify a custom format string for a progress bar.
For <code>custom</code> progress bars, this is compulsory. Format
strings may use glue templating, cli pluralization and cli theming. They
can also use a number of built-in cli progress variables, see ‘Progress
variables’ below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/cli_progress_bar.html">cli_progress_bar</a></span><span class="op">(</span></span>
<span>    total <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>    format <span class="op">=</span> <span class="st">"Step {step} | {pb_bar} {pb_percent}"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10000</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/cli_progress_bar.html">cli_progress_update</a></span><span class="op">(</span>set <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">10001</span><span class="op">:</span><span class="fl">20000</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/cli_progress_bar.html">cli_progress_update</a></span><span class="op">(</span>set <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">f</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-8.svg" width="100%"></p>
<p>For <code>custom</code> progress bars cli always uses the specified
format string. For other types, the end user might customize the format
string, see below.</p>
</div>
</div>
<div class="section level3">
<h3 id="end-user-customization">End user customization<a class="anchor" aria-label="anchor" href="#end-user-customization"></a>
</h3>
<div class="section level4">
<h4 id="quick-loops">Quick loops<a class="anchor" aria-label="anchor" href="#quick-loops"></a>
</h4>
<p>The <code>cli.progress_show_after</code> (default is two seconds)
option is the number seconds to wait before showing a progress bar.</p>
</div>
<div class="section level4">
<h4 id="custom-bars">Custom bars<a class="anchor" aria-label="anchor" href="#custom-bars"></a>
</h4>
<p>The end user can customize how a progress bar will look, by setting
one or more of the following options:</p>
<ul>
<li><code>cli.progress_bar_style</code></li>
<li><code>cli.progress_bar_style_unicode</code></li>
<li><code>cli.progress_bar_style_ascii</code></li>
</ul>
<p>On UTF-8 displays <code>cli.progress_bar_style_unicode</code> is
used, if set. Otherwise <code>cli.progress_bar_style</code> is used. On
non UTF-8 displays <code>cli.progress_bar_style_ascii</code> is used, if
set. Otherwise <code>cli.progress_bar_style</code> is used.</p>
<p>These options can be set to a built-in progress bar style name:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/cli_progress_styles.html">cli_progress_styles</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "classic"     "squares"     "dot"         "fillsquares" "bar"</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cli.progress_bar_style <span class="op">=</span> <span class="st">"fillsquares"</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/cli_progress_along.html">cli_progress_along</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-11.svg" width="100%"></p>
<p>Alternatively, they can be set to a list with entries
<code>complete</code>, <code>incomplete</code> and <code>current</code>,
to specify the characters (or strings) for the parts of the progress
bar:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cli.progress_bar_style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  complete <span class="op">=</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="../reference/ansi-styles.html">col_yellow</a></span><span class="op">(</span><span class="st">"\u2605"</span><span class="op">)</span>,</span>
<span>  incomplete <span class="op">=</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="../reference/ansi-styles.html">col_grey</a></span><span class="op">(</span><span class="st">"\u00b7"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/cli_progress_along.html">cli_progress_along</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-13.svg" width="100%"></p>
</div>
<div class="section level4">
<h4 id="custom-spinners">Custom spinners<a class="anchor" aria-label="anchor" href="#custom-spinners"></a>
</h4>
<p>Options to customize cli spinners:</p>
<ul>
<li><code>cli.spinner</code></li>
<li><code>cli.spinner_unicode</code></li>
<li><code>cli.spinner_ascii</code></li>
</ul>
<p>On UTF-8 displays <code>cli.spinner_unicode</code> is used, if set,
otherwise <code>cli.spinner</code>. On ASCII displays
<code>cli.spinner_ascii</code> is used, if set, otherwise
<code>cli.spinner</code>.</p>
<p>Use <code><a href="../reference/list_spinners.html">list_spinners()</a></code> to list all spinners and
<code><a href="../reference/demo_spinners.html">demo_spinners()</a></code> to take a peek at them.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cli.spinner <span class="op">=</span> <span class="st">"moon"</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/cli_progress_bar.html">cli_progress_bar</a></span><span class="op">(</span>format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strrep.html" class="external-link">strrep</a></span><span class="op">(</span><span class="st">"{cli::pb_spin} "</span>, <span class="fl">20</span><span class="op">)</span>, clear <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/cli_progress_bar.html">cli_progress_update</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">f</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="progress-advanced_files/figure-html/custom-spinner.svg" width="100%"></p>
</div>
<div class="section level4">
<h4 id="custom-format-strings">Custom format strings<a class="anchor" aria-label="anchor" href="#custom-format-strings"></a>
</h4>
<p>The end user may use a number of global options to customize how the
built-in progress bar types are displayed on the screen:</p>
<ul>
<li>
<code>cli.progress_format_iterator</code> is used for
<code>iterator</code> progress bars.</li>
<li>
<code>cli.progress_format_iterator_nototal</code> is used for
<code>iterator</code> progress bars with an unknown number of total
units.</li>
<li>
<code>cli.progress_format_tasks</code> is used for
<code>tasks</code> progress bars.</li>
<li>
<code>cli.progress_format_tasks_nototal</code> is used for
<code>tasks</code> progress bars with an unknown number of total
units.</li>
<li>
<code>cli.progress_format_download</code> is used for
<code>download</code> progress bars.</li>
<li>
<code>cli.progress_format_download_nototal</code> is used for
<code>download</code> progress bars with an unknown number of total
units.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="progress-variables">Progress variables<a class="anchor" aria-label="anchor" href="#progress-variables"></a>
</h3>
<p>Custom format strings may use progress variables in glue interpolated
expressions, to refer to the state of the progress bar. See
<code><a href="../reference/progress-variables.html">?"progress-variables"</a></code> in the manual for the list of
supported variables.</p>
<p>If you refer to a progress variable from a package, you need need to
import it or qualify the reference with <code>cli::</code>. When you set
a custom format string as an end user option, we suggest that you always
use the qualified form, in case the cli package is not attached. For
example, to set a minimal display for downloads you might write</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>cli.progress_format_download <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"{cli::col_cyan('\u2B07')} {cli::pb_spin} "</span>,</span>
<span>    <span class="st">"{cli::pb_name}[{cli::pb_current_bytes}/{cli::pb_total_bytes}]"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>to get</p>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-16.svg" width="100%"></p>
<p>You can use your own expressions and functions on progress bar
tokens. E.g. to show the current number of steps with letters instead of
numbers, use <code>letters[pb_current]</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/cli_progress_bar.html">cli_progress_bar</a></span><span class="op">(</span></span>
<span>    total <span class="op">=</span> <span class="fl">26</span>,</span>
<span>    format <span class="op">=</span> <span class="st">"{pb_spin} This is step {.emph {letters[pb_current]}}. {pb_spin}"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">3</span><span class="op">/</span><span class="fl">26</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/cli_progress_bar.html">cli_progress_update</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">f</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="progress-advanced_files/figure-html/function-of-token.svg" width="100%"></p>
</div>
<div class="section level3">
<h3 id="clearing-or-keeping-terminated-progress-bars">Clearing or keeping terminated progress bars<a class="anchor" aria-label="anchor" href="#clearing-or-keeping-terminated-progress-bars"></a>
</h3>
<p>By default terminated progress bars are removed from the screen. The
end user can set the <code>cli.progress_clear</code> option to
<code>FALSE</code> to override the default. In addition, the developer
can also change the default, using the <code>clear</code> parameter of
<code><a href="../reference/cli_progress_bar.html">cli_progress_bar()</a></code>. If both the option and the parameter
are set, the parameter is used.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-c-api">The C API<a class="anchor" aria-label="anchor" href="#the-c-api"></a>
</h2>
<p>To use the C cli progress API in your package, you need to add cli to
<code>LinkingTo</code> and <code>Imports</code>:</p>
<pre><code><span><span class="va">LinkingTo</span><span class="op">:</span> <span class="va">cli</span></span>
<span><span class="va">Imports</span><span class="op">:</span> <span class="va">cli</span></span></code></pre>
<p>In the C files you want to use the API from include
<code>cli/progress.h</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cli/progress.h&gt;</span></span></code></pre></div>
<p>Now you are ready to call cli functions. The C API is similar to the
traditional R API:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/cli_progress_bar.html">cli_progress_bar()</a></code> creates a progress bar.</li>
<li>
<code><a href="../reference/cli_progress_bar.html">cli_progress_update()</a></code> updates a progress bar.</li>
<li>
<code><a href="../reference/cli_progress_bar.html">cli_progress_done()</a></code> terminates it.</li>
</ol>
<p>A complete example:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>SEXP progress_test1<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  SEXP bar <span class="op">=</span> PROTECT<span class="op">(</span>cli_progress_bar<span class="op">(</span><span class="dv">1000</span><span class="op">,</span> NULL<span class="op">));</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    cli_progress_sleep<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">4</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">);</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>CLI_SHOULD_TICK<span class="op">)</span> cli_progress_set<span class="op">(</span>bar<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  cli_progress_done<span class="op">(</span>bar<span class="op">);</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  UNPROTECT<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  <span class="cf">return</span> Rf_ScalarInteger<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><img src="progress-advanced_files/figure-html/unnamed-chunk-17.svg" width="100%"></p>
<div class="section level3">
<h3 id="c-api-reference">C API reference<a class="anchor" aria-label="anchor" href="#c-api-reference"></a>
</h3>
<div class="section level4">
<h4 id="cli_should_tick">
<code>CLI_SHOULD_TICK</code><a class="anchor" aria-label="anchor" href="#cli_should_tick"></a>
</h4>
<p>A macro that evaluates to (int) 1 if a cli progress bar update is
due, and to (int) 0 otherwise. If the timer hasn’t been initialized in
this compilation unit yet, then it is always 0. To initialize the timer,
call <code>cli_progress_init_timer()</code> or create a progress bar
with <code><a href="../reference/cli_progress_bar.html">cli_progress_bar()</a></code>.</p>
</div>
<div class="section level4">
<h4 id="cli_progress_add">
<code>cli_progress_add()</code><a class="anchor" aria-label="anchor" href="#cli_progress_add"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_add<span class="op">(</span>SEXP bar<span class="op">,</span> <span class="dt">double</span> inc<span class="op">);</span></span></code></pre></div>
<p>Add a number of progress units to the progress bar. It will also
trigger an update if an update is due.</p>
<ul>
<li>
<code>bar</code>: progress bar object.</li>
<li>
<code>inc</code>: progress increment.</li>
</ul>
</div>
<div class="section level4">
<h4 id="cli_progress_bar">
<code>cli_progress_bar()</code><a class="anchor" aria-label="anchor" href="#cli_progress_bar"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>SEXP cli_progress_bar<span class="op">(</span><span class="dt">double</span> total<span class="op">,</span> SEXP config<span class="op">);</span></span></code></pre></div>
<p>Create a new progress bar object. The returned progress bar object
must be <code>PROTECT()</code>-ed.</p>
<ul>
<li>
<code>total</code>: Total number of progress units. Use
<code>NA_REAL</code> if it is not known.</li>
<li>
<code>config</code>: R named list object of additional parameters.
May be <code>NULL</code> (the C
<code>NULL~) or</code>R_NilValue<code>(the R</code>NULL`) for the
defaults.</li>
</ul>
<p><code>config</code> may contain the following entries:</p>
<ul>
<li>
<code>name</code>: progress bar name.</li>
<li>
<code>status</code>: (initial) progress bar status.</li>
<li>
<code>type</code>: progress bar type.</li>
<li>
<code>total</code>: total number of progress units.</li>
<li>
<code>show_after</code>: show the progress bar after the specified
number of seconds. This overrides the global <code>show_after</code>
option.</li>
<li>
<code>format</code>: format string, must be specified for custom
progress bars.</li>
<li>
<code>format_done</code>: format string for successful
termination.</li>
<li>
<code>format_failed</code>: format string for unsuccessful
termination.</li>
<li>
<code>clear</code>: whether to remove the progress bar from the
screen after termination.</li>
<li>
<code>auto_terminate</code>: whether to terminate the progress bar
when the number of current units equals the number of total progress
units.</li>
</ul>
<div class="section level5">
<h5 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h5>
<div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cli/progress.h&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>SEXP progress_test1<span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  SEXP bar <span class="op">=</span> PROTECT<span class="op">(</span>cli_progress_bar<span class="op">(</span><span class="dv">1000</span><span class="op">,</span> NULL<span class="op">));</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>    cli_progress_sleep<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">4</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">);</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>CLI_SHOULD_TICK<span class="op">)</span> cli_progress_set<span class="op">(</span>bar<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  cli_progress_done<span class="op">(</span>bar<span class="op">);</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  UNPROTECT<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  <span class="cf">return</span> Rf_ScalarInteger<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="cli_progress_done">
<code>cli_progress_done()</code><a class="anchor" aria-label="anchor" href="#cli_progress_done"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_done<span class="op">(</span>SEXP bar<span class="op">);</span></span></code></pre></div>
<p>Terminate the progress bar.</p>
<ul>
<li>
<code>bar</code>: progress bar object.</li>
</ul>
</div>
<div class="section level4">
<h4 id="cli_progress_init_timer">
<code>cli_progress_init_timer()</code><a class="anchor" aria-label="anchor" href="#cli_progress_init_timer"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_init_timer<span class="op">();</span></span></code></pre></div>
<p>Initialize the cli timer without creating a progress bar.</p>
</div>
<div class="section level4">
<h4 id="cli_progress_num">
<code>cli_progress_num()</code><a class="anchor" aria-label="anchor" href="#cli_progress_num"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="dt">int</span> cli_progress_num<span class="op">();</span></span></code></pre></div>
<p>Returns the number of currently active progress bars.</p>
</div>
<div class="section level4">
<h4 id="cli_progress_set">
<code>cli_progress_set()</code><a class="anchor" aria-label="anchor" href="#cli_progress_set"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_set<span class="op">(</span>SEXP bar<span class="op">,</span> <span class="dt">double</span> set<span class="op">);</span></span></code></pre></div>
<p>Set the progress bar to the specified number of progress units.</p>
<ul>
<li>
<code>bar</code>: progress bar object.</li>
<li>
<code>set</code>: number of current progress progress units.</li>
</ul>
</div>
<div class="section level4">
<h4 id="cli_progress_set_clear">
<code>cli_progress_set_clear()</code><a class="anchor" aria-label="anchor" href="#cli_progress_set_clear"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_set_clear<span class="op">(</span>SEXP bar<span class="op">,</span> <span class="dt">int</span> clear<span class="op">);</span></span></code></pre></div>
<p>Set whether to remove the progress bar from the screen. You can call
this any time before <code><a href="../reference/cli_progress_bar.html">cli_progress_done()</a></code> is called.</p>
<ul>
<li>
<code>bar</code>: progress bar object.</li>
<li>
<code>clear</code>: whether to remove the progress bar from the
screen, zero or one.</li>
</ul>
</div>
<div class="section level4">
<h4 id="cli_progress_set_format">
<code>cli_progress_set_format()</code><a class="anchor" aria-label="anchor" href="#cli_progress_set_format"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_set_format<span class="op">(</span>SEXP bar<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>format<span class="op">,</span> <span class="op">...);</span></span></code></pre></div>
<p>Set a custom format string for the progress bar. This call does not
try to update the progress bar. If you want to request an update, call
<code>cli_progress_add()</code>, <code>cli_progress_set()</code> or
<code><a href="../reference/cli_progress_bar.html">cli_progress_update()</a></code>.</p>
<ul>
<li>
<code>bar</code>: progress bar object.</li>
<li>
<code>format</code>: format string.</li>
<li>
<code>...</code>: values to substitute into
<code>format</code>.</li>
</ul>
<p><code>format</code> and <code>...</code> are passed to
<code>vsnprintf()</code> to create a format string.</p>
<p>Format strings may contain glue substitutions, referring to <a href="https://cli.r-lib.org/dev/reference/progress-variables.html">progress
variables</a>, pluralization, and cli styling.</p>
</div>
<div class="section level4">
<h4 id="cli_progress_set_name">
<code>cli_progress_set_name()</code><a class="anchor" aria-label="anchor" href="#cli_progress_set_name"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_set_name<span class="op">(</span>SEXP bar<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">);</span></span></code></pre></div>
<p>Set the name of the progress bar.</p>
<ul>
<li>
<code>bar</code>; progress bar object.</li>
<li>
<code>name</code>: progress bar name.</li>
</ul>
</div>
<div class="section level4">
<h4 id="cli_progress_set_status">
<code>cli_progress_set_status()</code><a class="anchor" aria-label="anchor" href="#cli_progress_set_status"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_set_status<span class="op">(</span>SEXP bar<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>status<span class="op">);</span></span></code></pre></div>
<p>Set the status of the progress bar.</p>
<ul>
<li>
<code>bar</code>: progress bar object.</li>
<li>
<code>status</code>: progress bar status.</li>
</ul>
</div>
<div class="section level4">
<h4 id="cli_progress_set_type">
<code>cli_progress_set_type()</code><a class="anchor" aria-label="anchor" href="#cli_progress_set_type"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_set_type<span class="op">(</span>SEXP bar<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>type<span class="op">);</span></span></code></pre></div>
<p>Set the progress bar type. Call this function right after creating
the progress bar with <code><a href="../reference/cli_progress_bar.html">cli_progress_bar()</a></code>. Otherwise the
behavior is undefined.</p>
<ul>
<li>
<code>bar</code>: progress bar object.</li>
<li>
<code>type</code>: progress bar type. Possible progress bar types:
<code>iterator</code>, <code>tasks</code>, <code>download</code> and
<code>custom</code>.</li>
</ul>
</div>
<div class="section level4">
<h4 id="cli_progress_update">
<code>cli_progress_update()</code><a class="anchor" aria-label="anchor" href="#cli_progress_update"></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="dt">void</span> cli_progress_update<span class="op">(</span>SEXP bar<span class="op">,</span> <span class="dt">double</span> set<span class="op">,</span> <span class="dt">double</span> inc<span class="op">,</span> <span class="dt">int</span> force<span class="op">);</span></span></code></pre></div>
<p>Update the progress bar. Unlike the simpler
<code>cli_progress_add()</code> and <code>cli_progress_set()</code>
function, it can force an update if <code>force</code> is set to 1.</p>
<ul>
<li>
<code>bar</code>: progress bar object.</li>
<li>
<code>set</code>: the number of current progress units. It is
ignored if negative.</li>
<li>
<code>inc</code>: increment to add to the current number of progress
units. It is ignored if <code>set</code> is not negative.</li>
<li>
<code>force</code>: whether to force an update, even if no update is
due.</li>
</ul>
<p>To force an update without changing the current number of progress
units, supply <code>set = -1</code>, <code>inc = 0</code> and
<code>force = 1</code>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
